<div class="container-flui">

  <!-- ====== Overview Section ====== -->
  <!-- <div class="card border-0 p-2  mb-2">

    <h5 class="fw-bold mb-3">Indent Request Overview</h5>

    <div class="d-flex justify-content-start align-items-start gap-4">

      <div class="d-flex flex-column pe-4 border-end">
        <div class="text-muted">Total Requests</div>
        <div class="fw-bold fs-4">23</div>
      </div>

      <div class="d-flex flex-column pe-4 border-end">
        <div class="text-muted">InProgress</div>
        <div class="fw-bold fs-4">10</div>
      </div>

      <div class="d-flex flex-column pe-4 border-end">
        <div class="text-muted">Approved</div>
        <div class="fw-bold fs-4">3</div>
      </div>

      <div class="d-flex flex-column pe-4 border-end">
        <div class="text-muted">PO Created</div>
        <div class="fw-bold fs-4">8</div>
      </div>

      <div class="d-flex flex-column">
        <div class="text-muted">Rejected</div>
        <div class="fw-bold fs-4">2</div>
      </div>

    </div>

  </div> -->

  <div class="card border-0 p-2 mt-1">
    <div class="card-bod border-0 d-flex justify-content-between align-items-center mb-1">

      <!-- LEFT SIDE: Title + Radio Buttons -->
      <div class="d-flex align-items-center gap-3">
        <!-- Title -->
        <h5 class="fw-bold mb-0">
          Indent Request List
          <span class="custom-text">({{ totalRecords || 0 }})</span>
        </h5>

        <!-- Radio Button Group -->
        <!-- <div class="btn-group" role="group">

          <button type="button" class="btn btn-sm left-rounded status-btn"
            [ngClass]="selectedStatus === 'approved' ? 'custom-btn' : 'inactive-btn'"
            (click)="statusFilter('approved')">
            Approved
          </button>

          <button type="button" class="btn btn-sm status-btn"
            [ngClass]="selectedStatus === 'rejected' ? 'custom-btn' : 'inactive-btn'"
            (click)="statusFilter('rejected')">
            Rejected
          </button>

          <button type="button" class="btn btn-sm right-rounded status-btn"
            [ngClass]="selectedStatus === 'pending' ? 'custom-btn' : 'inactive-btn'" (click)="statusFilter('pending')">
            Pending
          </button>

        </div> -->

        <div class="ios-tab-container">
          <div class="ios-tab-slider" [ngClass]="selectedStatus"></div>

          <div class="ios-tab" [class.active]="selectedStatus === 'all'" (click)="statusFilter('all')">
            All Records
          </div>

          <div class="ios-tab" [class.active]="selectedStatus === 'approved'" (click)="statusFilter('approved')">
            Approved
          </div>

          <div class="ios-tab" [class.active]="selectedStatus === 'rejected'" (click)="statusFilter('rejected')">
            Rejected
          </div>

          <div class="ios-tab" [class.active]="selectedStatus === 'pending'" (click)="statusFilter('pending')">
            Pending
          </div>
        </div>




      </div>

      <!-- RIGHT SIDE: Search box + Add button -->
      <div class="d-flex align-items-center gap-2">

        <!-- Search Box -->
        <div class="input-group input-group-sm" style="width: 260px;">
          <input type="search" class="form-control" placeholder="Search with Indent No., Plant, Material Code">
          <span class="input-group-text">
            <i class="bi bi-search"></i>
          </span>
        </div>

        <!-- Add Button -->
        <button class="btn custom-btn btn-sm px-3 shadow-none border-0 rounded" style="font-weight: 600;"
          (click)="addNewRequest()">
          Add New Request
        </button>

      </div>

    </div>

    <div class=" table-responsive scroll-container">

      <!-- ====== Table ====== -->
      <div class="table-responsive shadow-sm bg-white rounded">
        <table class="table table-bordered shadow-none table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Indent No.</th>
              <th>Division</th>
              <th>Material Code</th>
              <th>Material Description</th>
              <th>Plant</th>
              <th>Material Type</th>
              <th>Quantity</th>
              <th>Current Status</th>
              <th>Req. Date</th>
              <!-- <th>#</th> -->
            </tr>
          </thead>

          <tbody class="text-muted">
            <tr class="text-muted cursor-pointer" *ngFor="let item of paginatedData"
              (click)="manageById(item.indentNo)">
              <td class="text-muted">{{ item.indentNo }}</td>
              <td class="text-muted">{{ item.division }}</td>
              <td class="text-muted">{{ item.code }}</td>
              <td class="text-muted">{{ item.description }}</td>
              <td class="text-muted">{{ item.plant }}</td>
              <td class="text-muted">{{ item.type }}</td>
              <td class="text-muted">{{ item.qty }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-warning-subtle text-warning': item.status === 'Pending',
                  'bg-success-subtle text-success': item.status === 'Approved',
                  'bg-danger-subtle text-danger': item.status === 'Rejected',
                  'bg-info-subtle text-info': item.status === 'PO Created'
                }">
                  {{ item.statusText }}
                </span>
              </td>
              <td class="text-muted">{{ item.reqDate }}</td>
              <!-- <td class="text-muted">
              <button class="btn btn-sm btn-primary" >Edit</button>
            </td> -->

            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <!-- FOOTER PAGINATION -->
      <!-- <hr class="mt-2"> -->
      <div class="d-flex justify-content-between align-items-center mt-1" *ngIf="paginatedData.length > 0">

        <!-- Showing Records -->
        <span class="small badge custom-bg text-white">
          Showing {{ startIndex }} to {{ endIndex }} of {{ totalRecords }} Records
        </span>

        <!-- Pagination Buttons -->
        <ul class="pagination pagination-sm mb-1">

          <!-- Previous Button -->
          <li class="page-item">
            <button type="button" class="border-none text-white custom-action-btn px-2 py-1 me-2"
              (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1" [ngClass]="{
                'custom-bg': currentPage > 1,
                'bg-secondary': currentPage === 1
              }">
              <i class="bi bi-chevron-left"></i>
            </button>
          </li>

          <!-- Page Info -->
          <li class="page-item me-2 d-none d-md-block">
            <span class="px-3 py-1 small text-dark fw-bold border rounded bg-light">
              Page {{ currentPage }} of {{ totalPages }}
            </span>
          </li>

          <!-- Next Button -->
          <li class="page-item">
            <button type="button" class="border-none text-white custom-action-btn px-2 py-1 mr-2"
              (click)="changePage(currentPage + 1)" [disabled]="currentPage >= totalPages" [ngClass]="{
                'custom-bg': currentPage < totalPages,
                'bg-secondary': currentPage >= totalPages
              }">
              <i class="bi bi-chevron-right"></i>
            </button>
          </li>

        </ul>
      </div>
    </div>
  </div>
</div>





<div class="modal" *ngIf="visible">
  <div class="modal-content">

    <!-- Header -->
    <!-- <div class="d-flex justify-content-between align-items-center mb-1">
      <h5 class="m-0 fw-bold text-success">New Request </h5>
      <span class="close-btn" (click)="closeModal()">&times;</span>
    </div> -->
    <div class="d-flex justify-content-between align-items-center position-relative mb-1">
      <h5 class="m-0 fw-bold text-success mx-auto">New Request</h5>
      <span class="close-btn position-absolute end-0" (click)="closeModal()">&times;</span>
    </div>


    <form [formGroup]="requestForm">
      <div formArrayName="materials">
        <div class="border p-3 mb-3 rounded" *ngFor="let group of materialsArray.controls; let i = index"
          [formGroupName]="i">

          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-dark fw-bold">
              Planned Budget: ₹8,00,000 | Estimated Budget: ₹3,00,000
            </span>

            <button *ngIf="materialsArray.length > 1" type="button" class="btn btn-sm btn-danger px-2 py-0"
              (click)="removeMaterial(i)">
              Remove
            </button>
          </div>
          <div class="row mt-1 g-3">

            <!-- Division -->
            <div class="col-md-3">
              <label class="form-label">Division</label>
              <select class="form-select form-select-sm" formControlName="division"
                [ngClass]="{'is-invalid': group.get('division')?.invalid && group.get('division')?.touched}">
                <option value="">Select</option>
                <option *ngFor="let d of divisions" [value]="d?.value">{{ d?.name }}</option>
              </select>
            </div>

            <!-- Plant -->
            <div class="col-md-3">
              <label class="form-label">Plant</label>
              <select class="form-select form-select-sm" formControlName="plant"
                [ngClass]="{'is-invalid': group.get('plant')?.invalid && group.get('plant')?.touched}">
                <option value="">Select</option>
                <option *ngFor="let m of plant" [value]="m?.value">{{ m?.name }}</option>
              </select>
            </div>

            <!-- Material Type -->
            <div class="col-md-3">
              <label class="form-label">Material Type</label>
              <select class="form-select form-select-sm" formControlName="materialType"
                [ngClass]="{'is-invalid': group.get('materialType')?.invalid && group.get('materialType')?.touched}">
                <option value="">Select</option>
                <option *ngFor="let m of materialType" [value]="m?.value">{{ m?.name }}</option>
              </select>
            </div>

            <!-- Material Search -->
            <div class="col-md-3 position-relative">
              <label class="form-label">Material</label>

              <!-- Search Input -->
              <input type="search" class="form-control form-control-sm" formControlName="materialText"
                placeholder="Search material..." (input)="onSearch(i)" (blur)="onBlurMaterial(i)" [ngClass]="{
                 'is-invalid':
                   group.get('materialText')?.invalid &&
                   (group.get('materialText')?.touched || group.get('materialText')?.dirty)
                }" />

              <!-- Dropdown -->
              <ul class="list-group position-absolute w-100" *ngIf="group.get('showList')?.value"
                style="z-index: 1000; max-height: 200px; overflow-y: auto;">

                <li class="list-group-item list-group-item-action cursor-pointer"
                  *ngFor="let m of group.get('filteredMaterials')?.value" (click)="selectMaterial(i, m)">
                  {{ m.code }} - {{ m.name }}
                </li>

              </ul>
            </div>

            <!-- Quantity -->
            <div class="col-md-3">
              <label class="form-label">Quantity</label>
              <input type="text" class="form-control form-control-sm" formControlName="qty" placeholder="Enter Quantity"
                numbersOnly noFirstSpace maxlength="10"
                [ngClass]="{'is-invalid': group.get('qty')?.invalid && group.get('qty')?.touched}">
            </div>

            <!-- estimated budget -->
            <div class="col-md-3">
              <label class="form-label">Estimated Budget</label>
              <input type="text" class="form-control form-control-sm" formControlName="EstimatedBudget"
                placeholder="Enter Estimated Budget" numbersOnly noFirstSpace maxlength="10"
                [ngClass]="{'is-invalid': group.get('EstimatedBudget')?.invalid && group.get('EstimatedBudget')?.touched}">
            </div>

            <!-- Delivery Date  -->

            <div class="col-md-3">
              <label class="form-label">Delivery Date</label>
              <input type="date" class="form-control form-control-sm" formControlName="deliveryDate"
                placeholder="Enter Estimated Budget" maxlength="10"
                [ngClass]="{'is-invalid': group.get('deliveryDate')?.invalid && group.get('deliveryDate')?.touched}">
            </div>

            <!-- Comment -->
            <div class="col-md-3">
              <label class="form-label">Comment</label>
              <textarea rows="1" class="form-control form-control-sm" placeholder="Comments..." formControlName="reason"
                maxlength="50" [ngClass]="{'is-invalid': group.get('reason')?.invalid && group.get('reason')?.touched}">
              </textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="mt-4 d-flex gap-3 justify-content-end">
        <button type="button" class="custom-edit-btn px-4" (click)="addMaterial()">
          Add Material
        </button>


        <button type="button" class="btn custom-btn rounded btn-sm px-4" (click)="submitRequest()">
          Submit
        </button>
      </div>

    </form>
  </div>
</div>